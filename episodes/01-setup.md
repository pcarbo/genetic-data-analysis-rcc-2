# Analysis of Genetic Data 2: Setup

These instructions assume that you have a user or guest account on the
RCC compute cluster, [midway](https://rcc.uchicago.edu/docs). If you
plan to use a different computing resource (e.g., another compute
cluster, your own laptop), these instructions will be slightly
different.

### A. Introduce yourself

Introduce yourself to your neighbors. If you get stuck, please ask one
your peers for help before asking the instructor.

Conversely, if you have completed the steps more quickly than others,
consider helping your neighbors.

We may use the
[University of Chicago Google Docs](http://gdocs.uchicago.edu) to
share results results and ask questions as we work through the
episodes. Please open up the
[Workshop Google doc](http://tinyurl.com/h46hnm2) in your Web browser
and **introduce yourself**.

### B. Getting a midway user account

If you do not already have a
[user account on midway](http://rcc.uchicago.edu/getting-started/request-account),
the instructor or helpers can provide you with a
[YubiKey](https://www.yubico.com/start). This will allow you to access
*midway* for the duration of the workshop. (After the workshop, you
can request a proper user account
[here](https://rcc.uchicago.edu/getting-started/general-user-account-request)
provided you are associated with a Principal Investigator who already
has an RCC account.)

To access *midway* using the YubiKey, when prompted for your username,
enter `rccguestXXXX`, where `XXXX` is the last 4 digits shown on the
Yubikey:

![How to get username from YubiKey](/images/yubikey1.gif)

Whenever a password is requested for this guest account, the (very
long) password will be automatically generated by lightly touching the
metal contact:

![How to generate password from YubiKey](/images/yubikey2.gif)

### C. Connect to midway

Log on to midway using ssh with X forwarding:

```bash
ssh -X username@midway.rcc.uchicago.edu
```

If the `-X` option does not work, run ssh without this option.

Request an **interactive session** using the reservation for this
workshop. To safeguard against losing your connection, I recommend
using **screen**, but this is optional.

```bash
screen -S workshop-gda2
sinteractive --time=02:45:00 --mem=4G --reservation=gda2_rcc_workshop
```

### D. Clone git repository

Clone this repository in your home directory. (Note you do not need a
github account to do this.)

```bash
mkdir -p ~/git
cd ~/git
git clone https://github.com/pcarbo/genetic-data-analysis-rcc-2.git gda2
```

After completing this step, you should be able to see new files and
folders in `~/git/gda2`. If this doesn't work, you can instead
download a ZIP achive containing all the workshop materials:

```bash
mkdir -p ~/git
cd ~/git
wget https://github.com/pcarbo/genetic-data-analysis-rcc-2/archive/master.zip
unzip master.zip
mv genetic-data-analysis-rcc-2-master gda2
```

If you have a github account, feel free to log in to your account and
bookmark this repository by clicking the "Star" button at the
top-right corner of this webpage.

### E. Set up graphics

As part of this workshop, we will use R to generate graphics from
data. There are several graphics options on midway.

The recommend approach for this workshop is to forward graphics from
midway to your laptop using the X Windows system. The `-X` ssh option
will activate graphics forwarding so long as you already have the
appropriate software installed on your laptop. For example, with Mac
OS X you will need to download and install
[XQuartz](http://www.xquartz.org) before connecting to midway.

To check that you have correctly set up graphics for midway, jump to
the next section.

If this option does not work for you, a convenient alternative is to
use ThinLinc. The instructions for using ThinLinc on midway are given
[here](https://rcc.uchicago.edu/docs/connecting/index.html#connecting-with-thinlinc). 

A third option is to use [RStudio](https://rstudio.rcc.uchicago.edu)
in your browser. The rest of workshop assumes that you are running R
from the shell, but the R code should work equally in RStudio. (Note
that RStudio may not work with the RCC guest accounts.)

A fourth option is to use the [R kernel](https://irkernel.github.io)
in [Jupyter](https://jupyter.rcc.uchicago.edu). This option is less
recommended because our installation of Jupyter is not yet officially
supported, but this could work well for you.

### F. Test your graphics setup

Before continuing, let's make sure that you can generate and view
graphics in R using [ggplot2](http://ggplot2.org). First, start R,

```bash
cd ~/git/gda2
module load R/3.2
R --no-save
```

Once you have entered into the R environment, run the following:

```R
source("code/demo.ggplot.R")
```

This should create an oscillating arrangement of multicolour dots. If
you do not see this, it means your graphic setup isn't working.

Once you have completed this test, quit R:

```R
quit()
```

*In later episodes, we will omit the part about quitting R, so please
remember how to do this.*

### G. Load modules

Load the modules necessary to complete the exercises.
  
```bash
module load R/3.2
module load plink/1.90
module load gemma/0.95
```

### H. Download the data

To illustrate association analysis in a genetic data set, we will use
the data accompanying a
[recently published mouse genetics study](http://dx.doi.org/10.1038/ng.3609).
(*Disclosure: I am one of the authors on this paper.*) All the data
used to generate the results of this paper are available on
[Data Dryad](http://dx.doi.org/10.5061/dryad.2rs41).

Copy the README and the phenotype and genotype data files into the
[data](data) folder in this git repository. The data files take up
about 120 MB of space, so make sure you have enough space left over in
your home directory for these files. (Run the `quota` command to
check.) Retrieving the files can be easily done on the cluster by
following these steps:

```bash
cd ~/git/gda2/data
wget -O readme_data.txt datadryad.org/bitstream/handle/10255/dryad.117919/README.txt
wget http://datadryad.org/bitstream/handle/10255/dryad.117919/pheno.csv
wget http://datadryad.org/bitstream/handle/10255/dryad.117921/map.txt
wget http://datadryad.org/bitstream/handle/10255/dryad.117923/geno.txt.gz
wget http://datadryad.org/bitstream/handle/10255/dryad.117924/cfw.fam
wget http://datadryad.org/bitstream/handle/10255/dryad.117925/cfw.bim
wget http://datadryad.org/bitstream/handle/10255/dryad.117926/cfw.bed
```

After retrieving all these files, you should have 8 files in the data
folder (including the README file that was already there). We will
examine what is contained in these files in
[the next episode](02-explore-data.md).

:white_check_mark: Once you have successfully completed all these
steps, you are ready to move on to [Episode 2](02-explore-data.md).

### Notes

These instructions are adapted from [the setup instructions for
Part 1](https://github.com/pcarbo/genetic-data-analysis-rcc-1/blob/master/episodes/01-setup.md).
